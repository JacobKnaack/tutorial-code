<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <title>Tricked Out Chat</title>
  </head>
  <body>
    <div id="chat-container">
      <div class="conversations">
        <i class="fa fa-plus-square-o add-conversation" aria-hidden="true"></i>
        <div id="conversation-data"></div>
      </div>
      <div class="messaging-container">
        <div id="msgs" class="messages">

        </div>
        <form id="message-form" class="input-container">
          <input id="message-input" type="text" placeholder="Message" >
          <i class="fa fa-comment send-btn" onclick="sendMessage()" aria-hidden="true" ></i>
        </form>
      </div>
      <div id="contactInfo-side" >
        <div class="nameContainer">
          <div class="contactMenu">

          </div>
          <h2 id="contactName"></h2>
          <div id="contactInfo-side-text"></div>
        </div>
      </div>
    </div>

    <script>
      var chats = [
        {
          "id": "richie",
          "name": "Richie"
        },
        { 
          "id": "pennywise",
          "name": "Pennywise"  
        },
      ];
      var users = [
        {
          "id": "richie",
          "name": "Richie McDurban",
          "contact-info": {
            "phone": "(415)-536-7583",
            "email": "richie@yahoo.com",
            "location": "Dairy"
          }
        },
        {
          "id": "pennywise",
          "name": "Pennywise The Dancing Clown",
          "contact-info": {
            "phone": "(415)-666-6666",
            "email": "immaeatyou@yahoo.com",
            "location": "???"
          }
        },
      ];
      var messages = [
        {
          "id": "richie",
          "sender": "richie",
          "content": "Hey want to go playing in the rain this morning!",
          "created_at": 1230
        },
        {
          "id": "pennywise",
          "sender": "pennywise",
          "content": "Hey sorry about scaring you and your friends, I'm actually really friendly!",
          "created_at": 940
        },
        {
          "id": "richie",
          "sender": "me",
          "content": "Whoa no, don't you think we should watch out for that crazy clown guy?",
          "created_at": 1234
        },
        {
          "id": "pennywise",
          "sender": "me",
          "content": "Yeah right, you probably eat little kids or something.",
          "created_at": 1050
        }
      ];

      var selectedChat = "";

      // explain the sort function and the supplied comparison function
      function sortMessages() {
        messages.sort( function(a, b) {
          return a.created_at - b.created_at;
        })
      }

      // function for generting elements and adding them to conversation-data div
      function populateChatMenu () {
        var menuEls = "";
        for (var item in chats) {
          menuEls += "<div id="+ chats[item].id +" class=chat-item onclick='selectChat(\"" + chats[item].id +"\")'><i class='fa fa-user' aria-hidden='true'></i> " + chats[item].name + "<div id='contactInfo-small'><i class='fa fa-phone' aria-hidden='true'></i><i class='fa fa-envelope' aria-hidden='true'></i><i class='fa fa-map-marker' aria-hidden='true'></i></div></div>";
        }
        document.getElementById("conversation-data").innerHTML = menuEls;
      }

      // function for generating message elements and adding them to msgs div
      function populateMessageContainer (id) {
        var messageEls = "";
        for (var message in messages) {
          if ( messages[message].id === id ) {
            messageEls += "<div id=" + messages[message].sender + " class='message'> <i class='fa fa-user' aria-hidden='true'></i><p>" + messages[message].content + "</p></div>"
          } 
        } 
        document.getElementById("msgs").innerHTML = messageEls;
      }

      // functoin for iterating through users list and adding information to html
      function populateContactInfo(id) {
        console.log(id);
        for (var object in users) {
          if (users[object].id === id) {
            document.getElementById("contactName").innerHTML = "<i class='fa fa-user' aria-hidden='true'></i>" + users[object].name;
          }
        }
      }

      // sorts messages, sets selectedChat variable, and switches the selected class in the chat Menu
      function selectChat (id) {
        sortMessages();

        for (var item in chats) {
          if(chats[item].id === id) {
            toggleSelectedClass(id);
            selectedChat = id;
            populateContactInfo(id);
            populateMessageContainer(chats[item].id);
          }
        }
      }

      function sendMessage () {
        var text = document.getElementById("message-input").value;

        if (text.length === 0) {
          alert("please type a message");
          return;
        }

        messages.push({
          "id": selectedChat,
          "sender": "me",
          "content": text
        });
        populateMessageContainer(selectedChat);
        document.getElementById("message-form").reset();
      }

      function toggleSelectedClass (elId) {
        var selected = document.querySelector(".selected");
        if (selected) {
          selected.classList.remove("selected");
        }

        var element = document.getElementById(elId);
        element.classList.add('selected');
      }

      populateChatMenu();
      selectChat('richie');
    </script>
  </body>
</html>
