<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <title>Tricked Out Chat</title>
    <!-- Add the socket.io client instance to expose the io global variable -->
    <script src='/socket.io/socket.io.js'></script>
    <script src='/src/conversations.js'></script>
    <script src='/src/chat.js'></script>
    <script src='/src/user.js'></script>
  </head>
  <body>
    <div id="chat-container">
      <div class="conversations">
        <div id="userInfo" class="hidden">
          <p>Logged in as:</p>
          <h4 id='userInfo-username' onclick="logout(removeUser)"></h4>
        </div>
        
        <i class="fa fa-plus-square-o add-conversation"
           aria-hidden="true"
           onclick="toggleConversationForm()">
        </i>
        <div id="conversation-data"></div>
      </div>
      <div class="messaging-container">
        <div id="msgs" class="messages">

        </div>
        <form id="message-form" class="input-container" autocomplete="off">
          <input id="message-input" type="text" placeholder="Message" >
          <i class="fa fa-comment send-btn" onclick="sendMessage()" aria-hidden="true" ></i>
        </form>
      </div>
      <div id="contactInfo-side" >
        <div class="nameContainer">
          <div class="contactMenu">

          </div>
          <h2 id="contactName"></h2>
          <div id="contactInfo-side-text"></div>
        </div>
      </div>
    </div>

    <div id="conversationFormContainer" class="conversationForm hidden">
      <form id="conversationForm-el" class="modalForm" autocomplete="off">
        <input id="searchField"
               type="text"
               placeholder="Search for users: ">
        <div id="searchResults"></div>
        <div class="btns">
          <input class="searchBtn" type="button" value="close" onclick="toggleConversationForm()">
        </div>
      </form>
    </div>

    <div id='loginContainer' class='loginForm'>
      <form id='loginForm-el' onsubmit='login(setUser)' class="modalForm" autocomplete="off">
        <h2>Please Log In to Begin Chatting</h2>
        <input id='usernameInput'
               type="text"
               placeholder='UserName'>
      </form>
    </div>

    <script>
      // declare socket io variable for exposed socket client
      // const socket = io();

      // var selectedChat = "";

      // // explain the sort function and the supplied comparison function
      // function sortMessages() {
      //   messages.sort( function(a, b) {
      //     return a.created_at - b.created_at;
      //   })
      // }

      // // function for iterating through users list and adding information to html
      // function populateContactInfo(id) {
      //   for (var object in users) {
      //     if (users[object].id === id) {
      //       document.getElementById("contactName").innerHTML = "<i class='fa fa-user' aria-hidden='true'></i>" + users[object].name;
      //     }
      //   }
      // }

      // // sorts messages, sets selectedChat variable, and switches the selected class in the chat Menu
      // function selectChat (id) {
      //   for (var item in chats) {
      //     if(chats[item].id === id) {
      //       toggleSelectedClass(id);
      //       selectedChat = id;
      //       populateContactInfo(id);
      //       populateMessageContainer(chats[item].id);
      //     }
      //   }
      // }

      // function sendMessage () {
      //   var text = document.getElementById("message-input").value;

      //   if (text.length === 0) {
      //     alert("please type a message");
      //     return;
      //   }

      //   // add socket.emit function where the within sendMessage()
      //   socket.emit('chat message', text);
      //   socket.on('chat message', function(msg){
      //     console.log('client msg: ', msg);
      //     document.getElementById('msgs').innerHTML += "<div id='me' class='message'> <i class='fa fa-user' aria-hidden='true'></i><p>" + text + "</p></div>"
      //   });

      //   // messages.push({
      //   //   "id": selectedChat,
      //   //   "sender": "me",
      //   //   "content": text,
      //   //   "created_at": new Date()
      //   // });
      //   // populateMessageContainer(selectedChat);
      //   document.getElementById("message-form").reset();
      // }

      // function addUser(userId) {
      //   for ( var item in chats) {
      //     if ( chats[item].id === userId) {
      //       alert("this user is already in your chat menu");
      //       return;
      //     } 
      //   }

      //   chats.push({
      //     "id": userId,
      //     "name": userId.charAt(0).toUpperCase() + userId.slice(1)
      //   });
      //   toggleConversationForm();
      //   populateChatMenu();
      //   selectChat(userId);
      // }

      // function toggleSelectedClass (elId) {
      //   var selected = document.querySelector(".selected");
      //   if (selected) {
      //     selected.classList.remove("selected");
      //   }

      //   var element = document.getElementById(elId);
      //   element.classList.add('selected');
      // }

      // document.querySelector('#message-form').addEventListener("submit", function (event) {
      //   sendMessage();
      //   event.preventDefault();
      // }, false);

      // document.getElementById("searchField").addEventListener("input", function(e) {
      //   document.getElementById("searchResults").innerHTML = "";
      //   for ( var item in users ) {
      //     if ( users[item].name.toLowerCase().includes(this.value.toLowerCase()) ) {
      //       document.getElementById("searchResults").innerHTML += "<p class='usersResult' onclick='addUser(\"" + users[item].id +"\")'>" + users[item].name + "</p>"
      //     }
      //     if ( document.getElementById("searchField").value.length == 0) {
      //       document.getElementById("searchResults").innerHTML = "";
      //     } 
      //   }
      // });

      // populateChatMenu();
      // selectChat('richie');
    </script>
  </body>
</html>
